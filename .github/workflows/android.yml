# Cria o arquivo de dependências
cat <<EOF > package.json
{
  "name": "monstro-v18",
    "version": "1.0.0",
      "scripts": {
          "build": "mkdir -p www && cp index.html www/"
            },
              "dependencies": {
                  "@capacitor/android": "^5.0.0",
                      "@capacitor/core": "^5.0.0"
                        },
                          "devDependencies": {
                              "@capacitor/cli": "^5.0.0"
                                }
                                }
                                EOF
                                
                                # Cria a configuração do Capacitor
                                cat <<EOF > capacitor.config.json
                                {
                                  "appId": "com.monstrov18.app",
                                    "appName": "MONSTRO V18",
                                      "webDir": "www",
                                        "bundledWebRuntime": false
                                        }
                                        EOF
                                        
                                        # Cria a pasta para o robô de build
                                        mkdir -p .github/workflows
                                        
                                        # Cria o script que gera o APK no GitHub
                                        cat <<EOF > .github/workflows/android.yml
                                        name: Build Android APK
                                        on: [push]
                                        jobs:
                                          build:
                                              runs-on: ubuntu-latest
                                                  steps:
                                                        - uses: actions/checkout@v3
                                                              - name: set up JDK 17
                                                                      uses: actions/setup-java@v3
                                                                              with:
                                                                                        java-version: '17'
                                                                                                  distribution: 'zulu'
                                                                                                        - name: Install Dependencies
                                                                                                                run: npm install
                                                                                                                      - name: Build Project
                                                                                                                              run: |
                                                                                                                                        npm run build
                                                                                                                                                  npx cap add android
                                                                                                                                                            npx cap copy android
                                                                                                                                                                  - name: Build APK with Gradle
                                                                                                                                                                          run: |
                                                                                                                                                                                    cd android
                                                                                                                                                                                              ./gradlew assembleDebug
                                                                                                                                                                                                    - name: Upload APK
                                                                                                                                                                                                            uses: actions/upload-artifact@v3
                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                              name: MonstroV18-Native-APK
                                                                                                                                                                                                                                        path: android/app/build/outputs/apk/debug/app-debug.apk
                                                                                                                                                                                                                                        EOF
                                                                                                                                                                                                                                        name: Build Android APK
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'zulu'

      - name: Install Dependencies
        run: npm install

      - name: Build Android
        run: |
          npx cap add android
          cd android
          ./gradlew assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v3
        with:
          name: monstro-v18-apk
          path: android/app/build/outputs/apk/debug/app-debug.apk
